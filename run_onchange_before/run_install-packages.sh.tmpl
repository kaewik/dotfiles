#!/bin/bash
set -e

# --- System Packages (Ubuntu/Debian) ---
{{ if (or (eq .chezmoi.osRelease.id "ubuntu") (eq .chezmoi.osRelease.id "debian")) -}}
echo "Ubuntu/Debian detected. Running bootstrap..."
sudo apt-get update -qq

# Note: build-essential/clang for Neovim's Tree-sitter parsers
sudo apt-get install -y build-essential clang libclang-dev unzip curl cmake
{{ end -}}

# --- Install Mise (The Core) ---
if ! command -v mise &> /dev/null; then
    echo "Installing mise..."
    # Download to a temporary file first to avoid pipe syntax errors
    curl -fsSL https://mise.jdx.dev/install.sh > /tmp/install_mise.sh
    sh /tmp/install_mise.sh
    rm /tmp/install_mise.sh

    # Ensure it's in the PATH for the rest of this script
    export PATH="$HOME/.local/bin:$PATH"
fi

# --- Mise Install ---
# This command looks at your .config/mise/config.toml and installs everything (nvim, rg, fd, etc.)
echo "Installing tools via mise..."
mise install -y

# Update font cache
fc-cache -fv
